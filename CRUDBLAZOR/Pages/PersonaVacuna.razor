@*@page "/personavacuna"

@inject IDataAccess _data
@inject IConfiguration _config


<h3>PersonaVacuna</h3>

<div class="container-fluid">

    <div class="row">
        <div class="col-12">
            <EditForm Model="@OPersonaVacuna" OnValidSubmit="InsertData">
                <DataAnnotationsValidator />
                <ValidationSummary />
                <div class="row">
                    <div class="form-group col-sm-12 col-xl-6">
                        <label for="cedula">Cedula</label>
                        <InputText @bind-Value="@OPersonaVacuna.Cedula" class="form-control" />
                        <small id="helpCedula" class="text-muted">Ex.. 000-000000-0</small>
                    </div>
                    <div class="form-group  col-sm-12  col-xl-6">
                        <label for="cedula">Nombre</label>
                        <InputText @bind-Value="@OPersonaVacuna.Nombre" class="form-control" />
                        <small id="helpNombre" class="text-muted">Ex.. Jhon</small>
                    </div>
                    <div class="form-group  col-sm-12  col-xl-6">
                        <label for="cedula">Apellido</label>
                        <InputText @bind-Value="@OPersonaVacuna.Apellido" class="form-control" />
                        <small id="helpId" class="text-muted">Ex.. Smith </small>
                    </div>
                    <div class="form-group   col-sm-12  col-xl-6">
                        <label for="cedula">Telefono</label>
                        <InputText @bind-Value="@OPersonaVacuna.Telefono" class="form-control" />
                        <small id="helpId" class="text-muted">Ex.. 809-648-8462 </small>
                    </div>
                    <div class="form-group  col-sm-12  col-xl-6">
                        <label for="cedula">Fecha Nacimiento</label>
                        <input class="form-control" type="date" @bind="@OPersonaVacuna.FechaNacimiento" format-value="yyyy-MM-dd" />
                    </div>

                    <div class="form-group  col-sm-12  col-xl-6">
                        <label for="provinciaId">Provincia</label>
                        <select class="form-control" @bind="OPersonaVacuna.ProvinciaId">

                            @if (_cboProvincia != null)
                            {
                                <option value="0">--SELECCIONE--</option>
                                @foreach (var p in _cboProvincia)
                                {
                                    <option value="@p.ID_Provincia">@p.Nombre</option>

                                }
                            }
                            else
                            {
                                <option value="0">--No hay Data--</option>


                            }
                        </select>
                    </div>
                    <div class="form-group col-12 col-xl-6">
                        <label for="cedula">Signo Zodiacal</label>
                        <select @bind="@OPersonaVacuna.SignoZodId" class="form-control">

                            @if (_cboSignoZod != null)
                            {
                                <option value="0">--SELECCIONE--</option>
                                @foreach (var p in _cboSignoZod)
                                {
                                    <option value="@p.ID_SIGNO_Zodiacal">@p.Nombre</option>

                                }
                            }
                            else
                            {
                                <option value="0">--No hay Data--</option>

                            }

                        </select>

                    </div>
                    <div clas="form-group col-12 col-xl-6">
                        <button type="submit" class="btn btn-primary">Agregar Persona</button>
                        <button class="btn btn-primary" @onclick="UpdateData">Modificar Persona</button>
                    </div>

                </div>
            </EditForm>
        </div>
    </div>
</div>



@if (personavacunas == null)
{
    <p>Loading...</p>
}
else
{
    <div class="container-fluid">
        <div class="row">

            <div class="col-12">
                <table class="table">
                    <thead class="thead-dark">
                        <tr>
                            <th scope="col">Cedula</th>
                            <th scope="col">Nombres</th>
                            <th scope="col">Apellido</th>
                            <th scope="col">Telefono</th>
                            <th scope="col">FechaNacimiento</th>
                            <th scope="col">Provincia</th>
                            <th scope="col">Signo Zodiacal</th>
                            <th scope="col">Fecha Vacuna</th>
                            <th scope="col">Marca Vacuna</th>
                            <th scope="col">Dosis</th>
                            <th scope="col">Acciones</th>
                        </tr>
                    </thead>
                    <tbody>

                        @foreach (var p in personavacunas)
                        {
                        <tr>
                            <td>@p.CEDULA</td>
                            <td>@p.NOMBRE</td>
                            <td>@p.APELLIDO</td>
                            <td>@p.TELEFONO</td>
                            <td>@p.SIGNOZODIACAL</td>
                            <td>@p.PROVINCIA</td>
                            <td>@p.PROVINCIA</td>
                            <td>@p.PROVINCIA</td>
                            <td>@p.PROVINCIA</td>
                            <td>
                                <button class="btn btn-primary" @onclick="() => LoadEditar(p.CEDULA)"><i class="bi-pencil-fill"></i></button>
                                <button class="btn btn-danger" @onclick="() => DeleteData(p)"><i class="bi bi-x-octagon-fill"></i></button>
                            </td>

                        </tr>
                        }
                    </tbody>
                </table>
            </div>

        </div>
    </div>

}



@code {

    private PersonaVacunaModel OPersonaVacuna = new();

    private static bool ModoEditar = false;



    List<dynamic> personavacunas;
    private List<ComboBoxProvinciaModel> _cboProvincia;
    private List<ComboBoxSignoZodModel> _cboSignoZod;


    int AnswerServer;


    private async Task LoadEditar(string Cedula)
    {

        string query = "SELECT * FROM PERSONAVACUNA WHERE Cedula = @Cedula";
        OPersonaVacuna = await _data.LoadObject<PersonaVacunaModel, dynamic>(query, new { Cedula = Cedula }, _config.GetConnectionString("default"));
    }

    private async Task InsertData()
    {
        string query = "INSERT INTO PERSONAVACUNA (CEDULA,NOMBRE,APELLIDO,TELEFONO,FECHANACIMIENTO,PROVINCIAID,SIGNOZODID,FECHAVACUNA,MARCAID,DOSISID) " +
                       "values (@Cedula,@Nombre,@Apellido,@Telefono,@FechaNacimiento,@ProvinciaId,@SignoZodId,@FechaVacuna,@MarcaId,@DosisId)";

        AnswerServer = await _data.SaveData<dynamic>(query, OPersonaVacuna, _config.GetConnectionString("default"));
        OnInitialized();
    }

    private async Task UpdateData()
    {
        string query = "UPDATE PERSONAVACUNA SET Nombre=@Nombre,Apellido=@Apellido,Telefono=@Telefono," +
                       "FechaNacimiento=@FechaNacimiento,ProvinciaId=@ProvinciaId,SIGNOZODID=@SignoZodid, " +
                       "MarcaId=@MarcaId, DosisId=@DosisIdWhere Cedula= @Cedula";
        AnswerServer = await _data.SaveData<PersonaVacunaModel>(query, OPersonaVacuna, _config.GetConnectionString("default"));
        await OnInitializedAsync();
    }

    private async Task DeleteData(dynamic Persona)
    {
        string query = "DELETE PERSONAVACUNA Cedula= @Cedula";
        AnswerServer = await _data.SaveData(query, new { Cedula = Persona.CEDULA }, _config.GetConnectionString("default"));
        await OnInitializedAsync();
    }

    protected override async Task OnInitializedAsync()
    {
        string query = "SELECT * from PERSONAVACUNA";
        personavacunas = await _data.LoadData<dynamic, dynamic>(query, new { }, _config.GetConnectionString("default"));

        query = "SELECT ID_Provincia, Nombre FROM PROVINCIAS";

        _cboProvincia = await _data.LoadData<ComboBoxProvinciaModel, dynamic>(query, new { }, _config.GetConnectionString("default"));

        query = "SELECT ID_SIGNO_Zodiacal, Nombre FROM SIGNO_ZODIACAL";

        _cboSignoZod = await _data.LoadData<ComboBoxSignoZodModel, dynamic>(query, new { }, _config.GetConnectionString("default"));
    }
}*@

